{"version":3,"file":"index.js","sources":["../src/useKeyPress.ts","../src/index.ts"],"sourcesContent":["// Hook\nimport {useEffect, useState} from \"react\";\n\nlet counter = 0;\n\nexport function useKeyPress(cb: (k: string) => void, doRerender?: boolean) {\n    // State for keeping track of whether key is pressed\n    // const [keyPressed, setKeyPressed] = useState(false);\n    const [, rerender] = useState(0);\n    // If pressed key is our target key then set to true\n    function downHandler({ key }: {key: string}) {\n        cb(key);\n        if (doRerender) {\n            rerender(counter);\n        }\n    }\n\n    // If released key is our target key then set to false\n    /*const upHandler = ({ key }) => {\n        if (key === targetKey) {\n            setKeyPressed(false);\n        }\n    };*/\n\n    // Add event listeners\n    useEffect(() => {\n        window.addEventListener('keydown', downHandler);\n        //window.addEventListener('keyup', upHandler);\n        // Remove event listeners on cleanup\n        return () => {\n            window.removeEventListener('keydown', downHandler);\n            //window.removeEventListener('keyup', upHandler);\n        };\n    }, []); // Empty array ensures that effect is only run on mount and unmount\n\n    // return keyPressed;\n}","import {useEffect, useRef, useState} from \"react\";\nimport {useKeyPress} from \"./useKeyPress\";\n\n\ninterface FeatureCondition {\n    cb?: () => void,\n    keyCombo?: string[],\n    localStorage?: [string, string],\n    computed?: () => boolean\n}\n\nfunction applies(featureCondition: FeatureCondition, currentKeyCombo: string[]) {\n    let doesApply = true;\n\n    if (featureCondition.computed) {\n        doesApply = doesApply && featureCondition.computed();\n    }\n\n    if (featureCondition.localStorage) {\n        let value = window.localStorage.getItem(featureCondition.localStorage[0]);\n        doesApply = doesApply && value === featureCondition.localStorage[1];\n    }\n\n    if (featureCondition.keyCombo) {\n        doesApply = doesApply && featureCondition.keyCombo.length === currentKeyCombo.length;\n        for (let i = 0; i < featureCondition.keyCombo.length; i++) {\n            doesApply = doesApply && (featureCondition.keyCombo[i] === currentKeyCombo[i]);\n        }\n    }\n\n    return doesApply;\n}\n\nexport function useHiddenFeature(condition: FeatureCondition): boolean {\n    const keysPushedArray: {current: string[]} = useRef([]);\n\n    const [applied, setApplies] = useState(false);\n\n    // TODO useKeyPress handles changes to keycombo incorrectly. Or not at all.\n    useKeyPress((k) => {\n        if (!condition.keyCombo) return;\n        if (condition.keyCombo.length > keysPushedArray.current.length) {\n            keysPushedArray.current.splice(0, 1);\n        }\n        keysPushedArray.current.push(k);\n\n        if (applies(condition, keysPushedArray.current)) {\n            console.log(\"Activating secret!\");\n            setApplies(true);\n        }\n    });\n\n    useEffect(() => {\n        setInterval(() => {\n            if (applies(condition, keysPushedArray.current)) {\n                keysPushedArray.current.push(\"done\"); // TODO ugly as hell\n                console.log(\"Activating secret!\");\n                setApplies(true);\n            }\n        }, 1000);\n    }, []);\n\n    return applied;\n}\n\n\n"],"names":["useState","useEffect","useRef"],"mappings":"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"}